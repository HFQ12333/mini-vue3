{
  "version": 3,
  "sources": ["../src/index.ts", "../../shared/src/index.ts", "../src/effect.ts", "../src/reactive.ts"],
  "sourcesContent": ["export { reactive } from \"./reactive\";\r\nexport { effect } from \"./effect\";\r\n", "export const isObject = (val) => typeof val === \"object\" && val !== null;\r\nexport const isFunction = (val) => typeof val === \"function\";\r\n", "export function effect(fn) {\r\n  const effect = new ReactiveEffect(fn);\r\n  effect.run();\r\n}\r\nexport let activeEffect;\r\nclass ReactiveEffect {\r\n  public parent; // \u8BB0\u5F55\u5F53\u524D effect \u7684\u7236\u4EB2\r\n  public active = true; // \u9ED8\u8BA4\u662F\u6FC0\u6D3B\u72B6\u6001\r\n  public deps = []; // \u6536\u96C6\u7684\u4F9D\u8D56\uFF0C\u540E\u7EED\u4F1A\u7528\u4E8E\u6E05\u7406\u5DE5\u4F5C\r\n  constructor(public fn) {}\r\n  run() {\r\n    if (!this.active) {\r\n      return this.fn();\r\n    } else {\r\n      try {\r\n        this.parent = activeEffect; // \u7B2C\u4E00\u6B21\u662F undefined\r\n        activeEffect = this;\r\n        // \u6BCF\u6B21\u6267\u884C\u51FD\u6570\u524D\u90FD\u6E05\u9664\u4E4B\u524D\u7684\u4F9D\u8D56\r\n        cleanUpEffects(this);\r\n        return this.fn();\r\n      } finally {\r\n        activeEffect = this.parent;\r\n        this.parent = undefined;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nfunction cleanUpEffects(effect) {\r\n  const deps = effect.deps;\r\n  if (deps.length > 0) {\r\n    deps.forEach((dep) => {\r\n      dep.delete(effect);\r\n    });\r\n  }\r\n}\r\n\r\nconst targetMap = new WeakMap();\r\nexport function track(target, opertion, key) {\r\n  if (activeEffect) {\r\n    let depsMap = targetMap.get(target);\r\n    if (!depsMap) {\r\n      targetMap.set(target, (depsMap = new Map()));\r\n    }\r\n    let deps = depsMap.get(key);\r\n    if (!deps) {\r\n      depsMap.set(key, (deps = new Set()));\r\n    }\r\n    deps.add(activeEffect);\r\n    activeEffect.deps.push(deps);\r\n  }\r\n}\r\n\r\nexport function trigger(target, opertion, key, value, oldValue) {\r\n  const depsMap = targetMap.get(target);\r\n  if (!depsMap) return;\r\n  let effects = depsMap.get(key);\r\n  if (effects) {\r\n    effects = new Set(effects);\r\n    effects.forEach((effect) => {\r\n      if (effect !== activeEffect) {\r\n        effect.run();\r\n      }\r\n    });\r\n  }\r\n}\r\n", "import { isObject } from \"@vue/shared\";\r\nimport { track, trigger } from \"./effect\";\r\nexport const enum Reactive_FLAGS {\r\n  IS_REACTIVE = \"__v_isReactive\",\r\n}\r\nconst proxyMap = new WeakMap();\r\nexport function reactive(value) {\r\n  if (!isObject(value)) {\r\n    return value;\r\n  }\r\n  const exitsingProxy = proxyMap.get(value);\r\n  // \u5982\u679C\u5DF2\u7ECF\u88AB\u4EE3\u7406\u8FC7\uFF0C\u65E0\u9700\u91CD\u590D\u4EE3\u7406\r\n  if (exitsingProxy) {\r\n    return exitsingProxy;\r\n  }\r\n  // \u5982\u679C\u5DF2\u7ECF\u662F\u4EE3\u7406\u5BF9\u8C61\uFF0C\u65E0\u9700\u91CD\u590D\u4EE3\u7406\r\n  if (value[Reactive_FLAGS.IS_REACTIVE]) {\r\n    return value;\r\n  }\r\n  const proxy = new Proxy(value, {\r\n    get(target, key, receiver) {\r\n      if (key === Reactive_FLAGS.IS_REACTIVE) {\r\n        return true;\r\n      }\r\n      const res = Reflect.get(target, key, receiver);\r\n      track(target, \"get\", key);\r\n      if (res && isObject(res)) {\r\n        return reactive(res);\r\n      }\r\n      return res;\r\n    },\r\n    set(target, key, value, receiver) {\r\n      const oldValue = target[key];\r\n      const res = Reflect.set(target, key, value, receiver);\r\n      if (!Object.is(oldValue, value)) {\r\n        trigger(target, \"set\", key, value, oldValue);\r\n      }\r\n      return res;\r\n    },\r\n  });\r\n  proxyMap.set(value, proxy);\r\n  return proxy;\r\n}\r\n"],
  "mappings": "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",
  "names": ["effect", "value"]
}
